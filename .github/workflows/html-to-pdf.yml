name: Convert HTML to PDF (Separated Folders)

on:
  push:
    branches:
      - main
    paths:
      - "AAVA_HTML/.ready"

jobs:
  convert:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Install wkhtmltopdf
        run: sudo apt-get update && sudo apt-get install -y wkhtmltopdf

      - name: Create PDF folder
        run: mkdir -p AAVA_PDF

      - name: Convert HTML to PDF
        run: |
          for file in AAVA_HTML/*.html; do
            name=$(basename "$file" .html)
            wkhtmltopdf "$file" "AAVA_PDF/$name.pdf"
          done

      - name: Commit PDFs
        run: |
          git config user.name "github-actions"
          git config user.email "actions@github.com"
          git add AAVA_PDF/*.pdf
          git commit -m "Generate PDFs from HTML" || echo "No PDFs to commit"

      - name: Cleanup HTML files
        run: |
          rm -f AAVA_HTML/*.html
          rm -f AAVA_HTML/.ready
          rmdir AAVA_HTML || true


      - name: Commit cleanup
        run: |
          git add -u
          git commit -m "Cleanup HTML files" || echo "Nothing to clean"
          git push
